We can advanced TODO

```js
// auth/permission.js

export { permission }

function permission() {
}
```






shield(onCommentDelete, [t.number, t.string])
export const updateText(id, text) {
  const object = await Todo.findOne({ id })
  permission('author', object)
}


shield(onCommentDelete, [t.number, t.string])
export const updateText(id, text) {
  const todoItem = await usePermission(
    permission('author', async () => {
      return await Todo.findOne({ id })
    })
  )
}


shield(onCommentDelete, [t.number, t.string])
export const updateText(id, text) {
  const todoItem = await usePermission(permission('author', Todo.findOne({ id })))
}

async permission(permissionName, getObject) {
  return () => {
    const user = getContext()

    if (permissionName==='author') {
      if (user) {
        throw Abort()
      }
      const object = await getObject()
      if (object?.user.id !== user.id) {
        throw Abort()
      }
      return object
    }

    // ...
  }
}





allowRequired

shield(onCommentDelete, [shield.type.number])
export const updateText(id, text) {
  const todoItem = await getPermission('author', async () => await Todo.findOne({ id }))
}

async function getPermission(permission, getObject) {
  allow('I know that this is dangerous.')

  if (permission === 'public') {
    // Everyone is allowed to call the telefunction
    return
  }

  const { user } = getUser()

  if (!user) {
    throw Abort()
  }

  if (permission==='admin') {
    const object = await getObject()
    if(user.id !=== object.user?.id) {
      throw Abort()
    }
  }

  if (permission==='author') {
    const object = await getObject()
    if(user.id !=== object.user?.id) {
      throw Abort()
    }
  }
}



// auth/permissions.ts

export { getUser }
export { isAdmin }
export { getObjectOfUser }

function getObjectOfUser() {
}

function getUser() {
}
