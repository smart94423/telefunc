import { Link } from 'libframe-docs/components'

> We recommend taking the <Link text="Telefunc Tour" href="/tour" /> before reading this document.

## With `Abort()`

```js
// Comment.telefunc.js
// Environment: Node.js

import { getContext, Abort, shield } from 'telefunc'

shield(onCommentDelete, [shield.type.number])
export async function onCommentDelete(id) {
  const { user } = getContext()

  // Only admins are allowed to delete comments
  if( !user.isAdmin ) {
    throw Abort()
  }

  // ...
}
```

```jsx
// Comment.jsx
// Environment: Browser

import { onCommentDelete } from './Comment.telefunc.js'

function Comment({ id, text, context }) {
  const deleteButton = <button onClick={() => onCommentDelete(id)}>Delete</button>
  return <>
    <p>{ text }</p>
    {
      // We only show the delete button to admins
      !context.user.isAdmin ?  deleteButton : null
    }
  </>
}
```

The delete button is only shown to admins;
this means that whenever our frontend calls `onCommentDelete()`
we can assume the user to be an admin.

But we still need `Abort()`:
as we have seen in the <Link text="Telefunc Tour" href="/tour" />,
our `onCommentDelete()` telefunction can be called not only by our frontend but really by anyone.
A malicious user can try to call `onCommentDelete()` without admin priviledges but,
thanks to our `throw Abort()` condition,
the call will be aborted.

In other words, we use `Abort()` to protect against unexpected calls (calls not originating from out frontend, or if our frontend has a bug).

If is expected that our frontend sometimes makes calls without the right permissions, we `return` instead of `throw Abort()`.


## With `return`

```js
// *.telefunc.js
// Environment: Node.js

import { getContext } from 'telefunc'

export async function getTodoList() {
  const { user } = getContext()

  if (!user) {
    // It is expected that the user may not be logged-in. We `return { isNotLoggedIn: true }`
    // instead of `throw Abort()` so that the frontend can redirect the user to the login page.
    return { isNotLoggedIn : true }
  }

  // ...
}
```

In contrast to our previous telefunction `onCommentDelete()`,
here we expect our frontend to sometimes call `getTodoList()` without the right permissions;
we then `return` the information that the user is not logged-in to the frontend,
so that the frontend can react accordingly.

In general, we can `return` instead of `throw Abort()` to pass information to the frontend.


## Form Validation

It is expected that the user enters invalid form inputs; the frontend then usually reports back to the user what went wrong;
we `return` instead of `throw Abort()`.

```js
// *.telefunc.js
// Environment: Node.js

import { shield } from 'telefunc'

shield(onFormSubmit, [{ email: t.string }])
export async function onFormSubmit({ email }) {
  const invalidInputs = {}
  if (!email) {
    invalidInputs.firstName = 'Please enter your email.'
  } else if(!email.includes('@')) {
    invalidInputs.firstName = 'Invalid email; make sure to enter a valid email.'
  }
  if (Object.keys(invalidInputs).length > 0) {
    return { invalidInputs }
  }
  // ...
}
```
