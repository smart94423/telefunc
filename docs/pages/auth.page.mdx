import { Link } from 'libframe-docs/components'

Telefunctions can use `getContext()` to access information about the logged-in user:

```js
// TodoList.telefunc.js
// Environment: Node.js

import { getContext } from 'telefunc'

export { getTodoItems }

async function getTodoItems() {
  // We can access `user` here
  const { user } = getContext()
  // We can use `user.id` to find all to-do items of the logged-in user
  const authorId = user.id
  const todoItems = await Todo.findMany({ select: 'text', authorId })
  return todoItems
}
```

## Setup

We use `provideTelefuncContext()` to determine the context object.

```js
// server.js
// Environment: Node.js

import { provideTelefuncContext } from 'telefunc'

// Server middleware (Express.js/Fastify/Koa/Hapi/...)
app.use('*', async (req, res) => {
  // Authentication middlewares (e.g. Passport.js or Grant) provide information
  // about the logged-in user on the `req` object.
  const user = req.user

  // Or when using a third-party authentication provider (e.g. Auth0):
  const user = await authProviderApi.getUser(req.headers)

  // We make `user` available to our telefunctions
  provideTelefuncContext({ user })
})
```

## `getContext()` wrappers

For more convenience we can implement `getContext()` wrappers.

```js
// auth/getUser.ts
// Environment: Node.js

// Note that `auth/getUser.ts` is not a `.telefunc.js` file and `getUser()` not a telefunction
export { getUser }

import { Abort, getContext } from 'telefunc'

function getUser() {
  const { user } = getContext()
  if (!user) {
    throw Abort()
  }
  return user
}
```

Such wrappers allow us to achieve advanced permissions and hardned safety, see <Link href="/permissions#getcontext-wrappers" doNotInferSectionTitle={true} />.
